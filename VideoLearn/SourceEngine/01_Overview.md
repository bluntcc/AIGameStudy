---
title: Overview - å»¶è¿Ÿè¡¥å¿æ¦‚è¿°
tags:
  - source-engine
  - network
  - latency
  - valve
  - multiplayer
aliases:
  - Latency Overview
  - ç½‘ç»œå»¶è¿Ÿæ¦‚è¿°
created: 2026-01-20
chapter: 1
series: Latency Compensating Methods
author: Yahn W. Bernier (Valve)
---

# ğŸ“¡ Overview - å»¶è¿Ÿè¡¥å¿æ¦‚è¿°

> [!abstract] ç« èŠ‚æ‘˜è¦
> æœ¬ç« ä»‹ç»äº†åœ¨çº¿åŠ¨ä½œæ¸¸æˆé¢ä¸´çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼š**ç½‘ç»œå»¶è¿Ÿ**å’Œ**ä¸¢åŒ…**ã€‚å³ä½¿åœ¨å®½å¸¦æ—¶ä»£ï¼Œè¿™äº›é—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œå¿…é¡»é€šè¿‡æŠ€æœ¯æ‰‹æ®µæ©ç›–å…¶å½±å“ï¼Œä¸ºç©å®¶æä¾›æµç•…çš„æ¸¸æˆä½“éªŒã€‚

---

## æ ¸å¿ƒé—®é¢˜ (Core Challenges)

### ç½‘ç»œå»¶è¿Ÿçš„æœ¬è´¨

```mermaid
graph LR
    A[ç©å®¶ A] -->|å‘é€è¾“å…¥| B[äº’è”ç½‘]
    B -->|å»¶è¿Ÿ 50-150ms| C[æœåŠ¡å™¨]
    C -->|å¤„ç†| D[æ¸¸æˆçŠ¶æ€]
    D -->|å»¶è¿Ÿ 50-150ms| B
    B -->|ç»“æœ| A
    
    style A fill:#e1f5ff
    style C fill:#ffccbc
    style D fill:#fff4e1
```

**å¾€è¿”æ—¶å»¶ (Round Trip Time, RTT)**:

$$
RTT = t_{send} + t_{process} + t_{receive}
$$

å…¸å‹å€¼ï¼š
- **å±€åŸŸç½‘ (LAN)**: 1-5ms
- **åŸå¸‚å†…å®½å¸¦**: 20-50ms
- **è·¨å›½å®½å¸¦**: 100-300ms
- **å«æ˜Ÿç½‘ç»œ**: 600-1000ms

> [!danger] äººç±»æ„ŸçŸ¥é˜ˆå€¼
> - **< 100ms**: å‡ ä¹å¯Ÿè§‰ä¸åˆ°
> - **100-200ms**: æœ‰è½»å¾®å»¶è¿Ÿæ„Ÿ
> - **> 200ms**: æ˜æ˜¾å¡é¡¿ï¼Œä¸¥é‡å½±å“ä½“éªŒ

### ä¸¢åŒ…é—®é¢˜

```mermaid
pie title æ•°æ®åŒ…ä¸¢å¤±çš„å½±å“
    "æˆåŠŸé€è¾¾" : 95
    "ä¸¢åŒ… (å½±å“æ¸¸æˆ)" : 5
```

**ä¸¢åŒ…ç±»å‹**:
1. **è¾“å…¥ä¸¢å¤±**: ç©å®¶æ“ä½œæœªé€è¾¾æœåŠ¡å™¨
2. **çŠ¶æ€ä¸¢å¤±**: æœåŠ¡å™¨æ›´æ–°æœªé€è¾¾å®¢æˆ·ç«¯
3. **ç¡®è®¤ä¸¢å¤±**: ACK åŒ…ä¸¢å¤±å¯¼è‡´é‡ä¼ 

> [!warning] æ¸¸æˆä¸­çš„è¡¨ç°
> - è§’è‰²çªç„¶ç¬ç§»
> - æ“ä½œæ— å“åº”
> - å­å¼¹æ‰“ç©º
> - "æ©¡çš®ç­‹æ•ˆåº”" (Rubber Banding)

---

## å®½å¸¦æ—¶ä»£çš„æŒ‘æˆ˜

### ä¸ºä»€ä¹ˆå®½å¸¦ä¸èƒ½è§£å†³é—®é¢˜ï¼Ÿ

```mermaid
graph TD
    A[å®½å¸¦æå‡] --> B[å¸¦å®½å¢åŠ  âœ…]
    A --> C[å»¶è¿Ÿæ”¹å–„ âŒ]
    
    B --> D[æ›´å¤šæ•°æ®<br/>æ›´é«˜è´¨é‡]
    C --> E[ç‰©ç†æé™<br/>å…‰é€Ÿé™åˆ¶]
    
    E --> F[ä¸Šæµ· â†’ çº½çº¦<br/>â‰ˆ 40ms ç†è®ºæé™]
    E --> G[å®é™…å»¶è¿Ÿ<br/>â‰ˆ 150-250ms]
    
    style C fill:#ffccbc
    style E fill:#fff4e1
    style G fill:#ffccbc
```

> [!important] å…‰é€Ÿé™åˆ¶
> $$
> t_{min} = \frac{distance}{c}
> $$
> 
> å³ä½¿ä»¥å…‰é€Ÿä¼ è¾“ï¼Œä¸Šæµ·åˆ°çº½çº¦çš„å•ç¨‹å»¶è¿Ÿä¹Ÿéœ€è¦çº¦ **40ms**ã€‚åŠ ä¸Šè·¯ç”±è·³è½¬ã€å¤„ç†æ—¶é—´ï¼Œå®é™… RTT é€šå¸¸ > 150msã€‚

### å¯¹æ¯”ï¼šç¦»çº¿ vs åœ¨çº¿æ¸¸æˆ

| æ–¹é¢ | ç¦»çº¿æ¸¸æˆ | åœ¨çº¿æ¸¸æˆ |
|------|---------|---------|
| **è¾“å…¥å“åº”** | ç¬æ—¶ (< 1ms) | å»¶è¿Ÿ (50-200ms) |
| **ç›®æ ‡ä½ç½®** | å‡†ç¡® | è¿‡æ—¶ (æ’å€¼/é¢„æµ‹) |
| **ç¢°æ’æ£€æµ‹** | ç²¾ç¡® | è¿‘ä¼¼ (è¡¥å¿) |
| **ä½“éªŒ** | å®Œç¾æµç•… | éœ€è¦ä¼˜åŒ– |

---

## å¿…é¡»é‡‡å–çš„æªæ–½

> [!quote] Valve çš„è§‚ç‚¹
> "åœ¨é«˜èŠ‚å¥çš„åœ¨çº¿åŠ¨ä½œæ¸¸æˆä¸­ï¼Œå¦‚æœä¸é‡‡ç”¨å»¶è¿Ÿæ©ç›–æŠ€æœ¯ï¼Œæ¸¸æˆå‡ ä¹æ— æ³•æ¸¸ç©ã€‚"

### å»¶è¿Ÿè¡¥å¿çš„ä¸‰å¤§æ”¯æŸ±

```mermaid
graph TD
    A[å»¶è¿Ÿè¡¥å¿] --> B[å®¢æˆ·ç«¯é¢„æµ‹<br/>Client Prediction]
    A --> C[å®ä½“æ’å€¼<br/>Entity Interpolation]
    A --> D[å»¶è¿Ÿè¡¥å¿<br/>Lag Compensation]
    
    B --> E[æœ¬åœ°æ¨¡æ‹Ÿç§»åŠ¨]
    B --> F[ç«‹å³åé¦ˆ]
    
    C --> G[å¹³æ»‘å…¶ä»–ç©å®¶]
    C --> H[æ©ç›–æŠ–åŠ¨]
    
    D --> I[å†å²å›æº¯]
    D --> J[å‘½ä¸­ä¿®æ­£]
    
    style B fill:#e1f5ff
    style C fill:#fff4e1
    style D fill:#c8e6c9
```

1. **Client-Side Prediction** (å®¢æˆ·ç«¯é¢„æµ‹)
   - ç©å®¶ç«‹å³çœ‹åˆ°è‡ªå·±ç§»åŠ¨çš„æ•ˆæœ
   - å‡å°‘æ“ä½œå»¶è¿Ÿæ„Ÿ

2. **Entity Interpolation** (å®ä½“æ’å€¼)
   - å¹³æ»‘å…¶ä»–ç©å®¶çš„ç§»åŠ¨
   - æ©ç›–ç½‘ç»œæŠ–åŠ¨

3. **Lag Compensation** (å»¶è¿Ÿè¡¥å¿)
   - å›æº¯å†å²çŠ¶æ€è¿›è¡Œå‘½ä¸­åˆ¤å®š
   - ä¿è¯"æ‰€è§å³æ‰€å¾—"

---

## æŠ€æœ¯æŒ‘æˆ˜

### å·¥ç¨‹å¤æ‚åº¦

```mermaid
graph LR
    A[ç®€å•ç½‘ç»œæ¨¡å‹] -->|å¢åŠ é¢„æµ‹| B[ç»´æŠ¤ä¸¤ä»½ä»£ç ]
    B -->|å¢åŠ æ’å€¼| C[åŒæ­¥å¤æ‚åº¦â†‘]
    C -->|å¢åŠ è¡¥å¿| D[è°ƒè¯•å›°éš¾]
    D --> E[éœ€è¦ä¸“ä¸šå›¢é˜Ÿ]
    
    style A fill:#c8e6c9
    style E fill:#ffccbc
```

> [!warning] ä»£ç ç»´æŠ¤æˆæœ¬
> - **åŒå€ä»£ç **: Client å’Œ Server éœ€è¦ç›¸åŒçš„ç‰©ç†/ç§»åŠ¨é€»è¾‘
> - **åŒæ­¥æŒ‘æˆ˜**: ç¡®ä¿é¢„æµ‹å’Œæƒå¨çŠ¶æ€ä¸€è‡´
> - **è°ƒè¯•åœ°ç‹±**: ç½‘ç»œé—®é¢˜éš¾ä»¥å¤ç°å’Œè°ƒè¯•

### æƒè¡¡å–èˆ

```mermaid
graph TD
    A[è®¾è®¡é€‰æ‹©] --> B{ä¼˜å…ˆçº§}
    B -->|æµç•…æ€§| C[æ›´å¤šé¢„æµ‹<br/>å¯èƒ½å‡ºé”™]
    B -->|å‡†ç¡®æ€§| D[æ›´å°‘é¢„æµ‹<br/>å»¶è¿Ÿæ˜æ˜¾]
    
    C --> E[å¿«èŠ‚å¥ FPS]
    D --> F[ç­–ç•¥/å›åˆåˆ¶]
    
    style C fill:#fff4e1
    style D fill:#e1f5ff
```

---

## å†å²èƒŒæ™¯

### FPS ç½‘ç»œåŒæ­¥çš„æ¼”å˜

```mermaid
timeline
    title FPS ç½‘ç»œæŠ€æœ¯æ¼”è¿›
    1993 : Doom - ç‚¹å¯¹ç‚¹, æ— é¢„æµ‹
    1996 : Quake - å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¶æ„
    1998 : Half-Life - å®¢æˆ·ç«¯é¢„æµ‹
    2000s : Source Engine - å»¶è¿Ÿè¡¥å¿
    2010s : ç°ä»£å¼•æ“ - é«˜çº§è¡¥å¿ç®—æ³•
```

> [!example] é‡Œç¨‹ç¢‘æ¸¸æˆ
> - **Doom**: ç®€å•çš„ peer-to-peerï¼Œå»¶è¿Ÿæ˜æ˜¾
> - **Quake**: å¼•å…¥ authoritative server
> - **QuakeWorld**: å¼€åˆ›å®¢æˆ·ç«¯é¢„æµ‹
> - **Half-Life**: å®Œå–„é¢„æµ‹ç³»ç»Ÿ
> - **Counter-Strike**: Lag Compensation æˆä¸ºæ ‡é…

---

## å…³é”®æ•°æ®

### äººç±»ååº”æ—¶é—´

| ååº”ç±»å‹ | æ—¶é—´ | æ¸¸æˆå½±å“ |
|---------|------|---------|
| **è§†è§‰åˆºæ¿€** | 200-250ms | çœ‹åˆ°æ•Œäºº â†’ å¼€ç« |
| **å¬è§‰åˆºæ¿€** | 140-160ms | å¬åˆ°è„šæ­¥ â†’ è½¬èº« |
| **è‚Œè‚‰ååº”** | 30-50ms | æ‰‹æŒ‡æŒ‰é”® |
| **èŒä¸šç©å®¶** | 150-180ms | ç»¼åˆååº” |

> [!tip] è®¾è®¡å¯ç¤º
> å¦‚æœç½‘ç»œå»¶è¿Ÿ > 100msï¼Œä¼šæ˜¾è‘—è¶…è¿‡ç©å®¶çš„ååº”æ—¶é—´ï¼Œå¯¼è‡´"æ“ä½œä¸åé¦ˆè„±èŠ‚"ã€‚

---

## å­¦ä¹ è·¯çº¿

æœ¬ç³»åˆ—æ–‡ç« å°†æ·±å…¥æ¢è®¨ä»¥ä¸‹ä¸»é¢˜ï¼š

```mermaid
graph LR
    A[1. Overview] --> B[2. åŸºç¡€æ¶æ„]
    B --> C[3. ç”¨æˆ·è¾“å…¥]
    C --> D[4. å®¢æˆ·ç«¯é¢„æµ‹]
    D --> E[5. æ­¦å™¨é¢„æµ‹]
    E --> F[6. å·¥ç¨‹æŒ‘æˆ˜]
    F --> G[7. ç›®æ ‡æ˜¾ç¤º]
    G --> H[8. å»¶è¿Ÿè¡¥å¿]
    H --> I[9. æ¸¸æˆè®¾è®¡å½±å“]
    I --> J[10. ç»“è®º]
    
    style A fill:#e1f5ff
    style D fill:#fff4e1
    style H fill:#c8e6c9
```

---

## å»¶ä¼¸æ€è€ƒ

> [!question] è®¨è®ºé—®é¢˜
> 1. ä¸ºä»€ä¹ˆäº‘æ¸¸æˆ (Cloud Gaming) çš„å»¶è¿Ÿé—®é¢˜æ›´ä¸¥é‡ï¼Ÿ
> 2. VR æ¸¸æˆå¯¹å»¶è¿Ÿçš„è¦æ±‚ä¸ºä»€ä¹ˆæ›´é«˜ (< 20ms)ï¼Ÿ
> 3. æ ¼æ–—æ¸¸æˆå¦‚ä½•å¤„ç†å»¶è¿Ÿ (Rollback Netcode)?
> 4. èƒ½å¦ç”¨ AI é¢„æµ‹ç©å®¶è¡Œä¸ºæ¥è¿›ä¸€æ­¥å‡å°‘å»¶è¿Ÿæ„Ÿï¼Ÿ

---

## ç›¸å…³é“¾æ¥

- Next: [[02_Basic_Architecture|åŸºç¡€æ¶æ„]]
- Related: [[Rocket League ç‰©ç†ç³»ç»Ÿè¯¦è§£|Rocket League ç½‘ç»œåŒæ­¥]]
- Reference: [Valve Developer Wiki](https://developer.valvesoftware.com/)

---

#source-engine #networking #latency #game-development #valve

^latency-overview
